<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.rawgit.com/konvajs/konva/0.11.1/konva.min.js"></script>
    <meta charset="utf-8">
    <title>Konva Shape Events Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #F0F0F0;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <script>
        var r = 100; //radius
        var L = r * Math.sqrt(3); // length of equilateral sides
        var cx = 200;
        var cy = 300;
        var h = (Math.sqrt(3) / 2) * L
        var coord = [
            [cx, cy - h + h / 3],
            [cx - L / 2, cy + h / 3],
            [cx + L / 2, cy + h / 3]
        ]
        var totaldist = r * 3
        var budget = 18

        var dims = ['Kleur', 'Vorm', 'Patroon']



        function dist(x1, y1, x2, y2) {
            return Math.sqrt( (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2) );
        }

        function onSide(xp,yp){

            var c = coord

            //K-V-P

            for (var i = 0; i < 3; i++) {

                if (i == O) {p1=c[1]}
                //var y = ((c[i][1]-c[])/(x2-y1))*(x-xv)+ yv
                //if (y-y1 < 0.1) {
                    return i
                }




        }







        var stage = new Konva.Stage({
            container: 'container',
            width: 700,
            height: 500
        });

        var layer = new Konva.Layer();


        var triangle = new Konva.RegularPolygon({
            x: cx,
            y: cy,
            sides: 3,
            radius: r,
            //fill: 'white',
            stroke: 'black',
            strokeWidth: 5
        });


        var lines = new Konva.Group({
            x: 0,
            y: 0,
        });

        for (var n = 0; n < 3; n++) {

            var line = new Konva.Line({
                points: [cx, cy, coord[n][0], coord[n][1]],
                name: dims[n],
                stroke: 'gray',
                strokeWidth: 2
            });
            lines.add(line);
        }

        var labels = new Konva.Group({
            x: 0,
            y: 0,
        });
        offsets=[[-20,-60],[-70,0],[20,0]]

        for (var n = 0; n < 3; n++) {
            var label = new Konva.Text({
                x: coord[n][0]+offsets[n][0],
                y: coord[n][1]+offsets[n][1],
                fontFamily: 'Calibri',
                fontSize: 24,
                text: dims[n] + "\n" + String(budget/3),
                fill: 'black'
            });
            labels.add(label);
        }

        var circle = new Konva.Circle({
            x: cx,
            y: cy,
            radius: 7,
            fill: 'orange',
            stroke: 'black',
            strokeWidth: 4
        });
        var beliefs = lines.getChildren()
        var texts = labels.getChildren()


        triangle.on('mouseout', function() {
            circle.setX(cx);
            circle.setY(cy);

            for (i = 0; i < 3; i++) {
                beliefs[i].setPoints([cx, cy, coord[i][0], coord[i][1]]);
                texts[i].setText(dims[i] + "\n" + String(budget/3));
                layer.draw();
            }
        });

        triangle.on('mousemove', function() {
            var mousePos = stage.getPointerPosition();
            var x = mousePos.x;
            var y = mousePos.y;

            var dists = [0, 0, 0];
            var tot = 0;
            var values = [1, 1, 1]
            beliefs = lines.getChildren()
            for (i = 0; i < 3; i++) {
                dists[i] = dist(x, y, coord[i][0], coord[i][1])
                tot = tot + dists[i]
                beliefs[i].setPoints([x, y, coord[i][0], coord[i][1]]);

            }

            for (i = 0; i < 3; i++) {
                values[i] = Math.round(((1 - dists[i] / tot) - 0.5) * 2 * budget * 10) / 10
                texts[i].setText(dims[i] + "\n" + String(dists[i]) + "\n" + String(tot));
            }
            layer.draw();
            //console.log(tot, dists);

            circle.setX(x)
            circle.setY(y)



        });




        layer.add(lines);
        layer.add(labels);
        layer.add(circle);
        layer.add(triangle);



        // add the layer to the stage

        stage.add(layer);
    </script>

</body>

</html>
